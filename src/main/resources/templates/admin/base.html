<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	th:fragment="layout(content, pageScript, activePage)">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MK Admin Portal</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
	integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
	crossorigin="anonymous" referrerpolicy="no-referrer" />

<link rel="stylesheet" th:href="@{/css/base.css(v=1.9)}">
<link rel="stylesheet" th:href="@{/css/style-admin.css(v=1.9)}">
</head>
<body id="admin-body">
	<nav class="admin-mobile-nav">
		<button class="sidebar-toggle-btn" id="sidebarToggle">
			<i class="fa-solid fa-bars"></i>
		</button>
		<a class="mobile-brand" th:href="@{/admin/dashboard}">MK Admin
			Portal</a>
			
		<div class="d-flex align-items-center ms-auto">
			<div class="dropdown">
				<a class="nav-link position-relative" href="#" id="mobileAdminNotificationDropdown"
					role="button" data-bs-toggle="dropdown" aria-expanded="false"
					style="color: var(--light); font-size: 1.2rem;"> 
					<i class="fa-solid fa-bell"></i>
					<span th:if="${unreadAdminNotificationCount > 0}"
						class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger admin-notification-badge"
						style="font-size: 0.6rem; padding: 0.25em 0.5em;"
						id="mobile-admin-notification-badge"
						th:text="${unreadAdminNotificationCount > 9 ? '9+' : unreadAdminNotificationCount}">
					</span>
				</a>
				<ul class="dropdown-menu dropdown-menu-end"
					aria-labelledby="mobileAdminNotificationDropdown"
					id="mobile-admin-notification-list">
					<li>
						<h6 class="dropdown-header">Admin Notifications</h6>
					</li>
					<li th:each="notif : ${adminNotifications}">
						<a class="dropdown-item notification-item" th:href="@{${notif.link}}" th:data-notification-id="${notif.id}">
							<span class="d-block small" th:text="${notif.message}">...</span>
							<span class="d-block text-muted" style="font-size: 0.75rem;" 
								th:text="${#temporals.format(notif.createdAt, 'MMM dd, h:mm a')}"></span>
						</a>
					</li>
					<li th:if="${#lists.isEmpty(adminNotifications)}">
						<span class="dropdown-item-text text-muted">No unread notifications</span>
					</li>
					<li><hr class="dropdown-divider"></li>
					<li>
						<a class="dropdown-item text-center small" th:href="@{/admin/orders}">View All Orders</a>
					</li>
				</ul>
			</div>
			
			<form th:action="@{/logout}" method="post" class="d-inline ms-2">
				<button type="submit" class="btn btn-custom-outline btn-sm"
					style="--bs-btn-color: var(--light); --bs-btn-border-color: var(--light);">
					Log Out</button>
			</form>
		</div>
	</nav>

	<div class="sidebar-overlay" id="sidebarOverlay"></div>

	<div class="admin-wrapper">

		<aside class="admin-sidebar" id="admin-sidebar">
			<div class="sidebar-header">
				<button class="sidebar-toggle-btn d-none d-lg-block"
					id="desktopSidebarToggle">
					<i class="fa-solid fa-bars"></i>
				</button>
			</div>

			<nav class="nav flex-column">
				<div sec:authorize="hasAuthority('VIEW_DASHBOARD')">
					<a class="nav-link" th:href="@{/admin/dashboard}"
						th:classappend="${activePage == 'dashboard' ? 'active' : ''}">
						<i class="fa-solid fa-chart-line fa-fw"></i> <span
						class="nav-link-text">Dashboard</span>
					</a>
				</div>
				<div sec:authorize="hasAuthority('VIEW_CUSTOMERS')">
					<a class="nav-link" th:href="@{/admin/customers}"
						th:classappend="${activePage == 'customers' ? 'active' : ''}">
						<i class="fa-solid fa-users fa-fw"></i> <span
						class="nav-link-text">Customer Management</span>
					</a>
				</div>
				<div sec:authorize="hasAuthority('VIEW_ADMINS')">
					<a class="nav-link" th:href="@{/admin/admins}"
						th:classappend="${activePage == 'admins' ? 'active' : ''}"> <i
						class="fa-solid fa-user-shield fa-fw"></i> <span
						class="nav-link-text">Admin Management</span>
					</a>
				</div>
				<div sec:authorize="hasAuthority('VIEW_ORDERS')">
					<a class="nav-link" th:href="@{/admin/orders}"
						th:classappend="${activePage == 'orders' ? 'active' : ''}"> <i
						class="fa-solid fa-box fa-fw"></i> <span class="nav-link-text">Order
							Management</span>
					</a>
				</div>
				<div sec:authorize="hasAuthority('VIEW_PRODUCTS')">
					<a class="nav-link" th:href="@{/admin/products}"
						th:classappend="${activePage == 'products' ? 'active' : ''}">
						<i class="fa-solid fa-burger fa-fw"></i> <span
						class="nav-link-text">Product Management</span>
					</a>
				</div>
				<div sec:authorize="hasAuthority('VIEW_INVENTORY')">
					<a class="nav-link" th:href="@{/admin/inventory}"
						th:classappend="${activePage == 'inventory' ? 'active' : ''}">
						<i class="fa-solid fa-boxes-stacked fa-fw"></i> <span
						class="nav-link-text">Inventory Management</span>
					</a>
				</div>
				<div sec:authorize="hasAuthority('VIEW_TRANSACTIONS')">
					<a class="nav-link" th:href="@{/admin/transactions}"
						th:classappend="${activePage == 'transactions' ? 'active' : ''}">
						<i class="fa-solid fa-money-bill-wave fa-fw"></i> <span
						class="nav-link-text">Transaction History</span>
					</a>
				</div>
				<div sec:authorize="hasAuthority('EDIT_SITE_SETTINGS')">
					<a class="nav-link" th:href="@{/admin/settings}"
						th:classappend="${activePage == 'settings' ? 'active' : ''}">
						<i class="fa-solid fa-gear fa-fw"></i> <span class="nav-link-text">Site
							Management</span>
					</a>
				</div>
				<div sec:authorize="hasAuthority('VIEW_ACTIVITY_LOG')">
					<a class="nav-link" th:href="@{/admin/activity-log}"
						th:classappend="${activePage == 'activity-log' ? 'active' : ''}">
						<i class="fa-solid fa-clipboard-list fa-fw"></i> <span
						class="nav-link-text">Activity Log</span>
					</a>
				</div>
			</nav>
		</aside>

		<div class="admin-content" id="admin-content">

			<nav class="admin-content-navbar">

				<div class="d-flex align-items-center">
					<a class="navbar-brand-top" th:href="@{/admin/dashboard}">MK
						Admin Panel</a>
				</div>


				<ul
					class="navbar-nav ms-auto text-center align-items-center flex-row">
					<li class="nav-item">
						<div class="dropdown">
							<button class="btn btn-custom dropdown-toggle" type="button"
								id="adminUserDropdown" data-bs-toggle="dropdown"
								aria-expanded="false">
								<i class="bi bi-person-circle me-1"></i> <span
									sec:authentication="principal.username">Username</span>
							</button>
							<ul class="dropdown-menu dropdown-menu-end"
								aria-labelledby="adminUserDropdown">
								<li><span class="dropdown-item-text">Welcome, <strong
										sec:authentication="principal.username">User</strong>!
								</span></li>
								<li><hr class="dropdown-divider"></li>
								<li><a class="dropdown-item" th:href="@{/}"> <i
										class="fa-solid fa-store fa-fw me-1"></i> View Site
								</a></li>
								<li><a class="dropdown-item"
									th:href="@{/admin/admins(showModal='editProfileModal')}"> <i
										class="fa-solid fa-user-pen fa-fw me-1"></i> Edit My Profile
								</a></li>
								<li><hr class="dropdown-divider"></li>
								<li>
									<form th:action="@{/logout}" method="post" class="d-inline">
										<button type="submit" class="dropdown-item">
											<i class="fa-solid fa-right-from-bracket fa-fw me-1"></i> Log
											Out
										</button>
									</form>
								</li>
							</ul>
						</div>
					</li>

					<li class="nav-item dropdown"><a class="nav-link position-relative" href="#"
						id="notificationDropdown" role="button" data-bs-toggle="dropdown"
						aria-expanded="false" style="font-size: 1.2rem;"> <i
							class="fa-solid fa-bell"></i> <span
							th:if="${unreadAdminNotificationCount > 0}"
							class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger admin-notification-badge"
							style="font-size: 0.6rem; padding: 0.25em 0.5em;"
							id="desktop-admin-notification-badge"
							th:text="${unreadAdminNotificationCount > 9 ? '9+' : unreadAdminNotificationCount}">
						</span>
					</a>
						<ul class="dropdown-menu dropdown-menu-end"
							aria-labelledby="notificationDropdown"
							id="desktop-admin-notification-list">
							<li>
								<h6 class="dropdown-header">Admin Notifications</h6>
							</li>
							<li th:each="notif : ${adminNotifications}"><a
								class="dropdown-item notification-item"
								th:href="@{${notif.link}}" th:data-notification-id="${notif.id}"> 
								<span class="d-block small"
									th:text="${notif.message}">...</span> <span
									class="d-block text-muted" style="font-size: 0.75rem;"
									th:text="${#temporals.format(notif.createdAt, 'MMM dd, h:mm a')}"></span>
							</a></li>
							<li th:if="${#lists.isEmpty(adminNotifications)}"><span
								class="dropdown-item-text text-muted">No unread
									notifications</span></li>
							<li><hr class="dropdown-divider"></li>
							<li><a class="dropdown-item text-center small"
								th:href="@{/admin/orders}">View All Orders</a></li>
						</ul></li>

				</ul>
			</nav>

			<main class="admin-content-page" th:insert="${content}"></main>

			<footer class="footer mt-auto admin-footer">
				<div class="container">
					<p class="mb-0" th:text="${siteSettings.footerText}">Â© 2025 MK
						Toasted Siopao | All Rights Reserved</p>
				</div>
			</footer>

		</div>
	</div>

	<div class="toast-container position-fixed top-0 end-0 p-3"
		style="z-index: 1100"></div>

	<div class="modal fade" id="confirmDeleteModal" tabindex="-1"
		aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="confirmDeleteModalLabel">Confirm
						Action</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p id="confirmDeleteMessage">Are you sure you want to delete
						this item?</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-action-delete"
						id="confirmDeleteButton">Delete</button>
					<button type="button" class="btn btn-custom-secondary"
						data-bs-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="confirmSaveModal" tabindex="-1"
		aria-labelledby="confirmSaveModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="confirmSaveModalLabel">Confirm
						Changes</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p id="confirmSaveMessage">Are you sure you want to save these
						changes?</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-action-add"
						id="confirmSaveButton">Confirm</button>
					<button type="button" class="btn btn-custom-secondary"
						data-bs-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>
	
	<div class="modal fade" id="passwordConfirmDeleteModal" tabindex="-1"
		aria-labelledby="passwordConfirmDeleteModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="passwordConfirmDeleteModalLabel">
						<i class="fa-solid fa-shield-halved me-2"></i>Secure Delete
						Confirmation
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p id="passwordConfirmDeleteMessage">Are you sure you want to
						delete this item?</p>
					<div class="alert alert-warning small">
						<i class="fa-solid fa-triangle-exclamation me-1"></i> This action
						is irreversible. To proceed, please enter the <strong>Owner
							Admin</strong> password.
					</div>
					<div class="mb-3">
						<label for="secureDeletePassword" class="form-label">Owner
							Password</label> <input type="password" class="form-control"
							id="secureDeletePassword" required>
						<div class="invalid-feedback"
							id="secureDeletePasswordFeedback">Password cannot be
							empty.</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-action-delete"
						id="passwordConfirmDeleteButton">
						<i class="fa-solid fa-trash me-1"></i> Confirm Delete
					</button>
					<button type="button" class="btn btn-custom-secondary"
						data-bs-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>

	<script th:src="@{/js/admin-utils.js}"></script>
	<script th:src="@{/js/global-script.js}"></script>
	<script th:src="@{/js/admin-global.js}"></script>
	<script th:src="@{/js/notification-handler.js}"></script> <div th:replace="${pageScript}"></div>
</body>
</html>