<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{admin/base :: layout(~{::main}, ~{::script})}">
<head>
<title>Manage Customers - MK Admin Portal</title>
</head>
<body>
	<main class="container my-4"
		th:attr="data-show-add-customer-modal=${#fields.hasErrors('customerUserDto.*') ? 'true' : 'false'},
                 data-show-manage-admins-modal=${#fields.hasErrors('adminUserDto.*') ? 'true' : 'false'},
                 data-show-edit-customer-modal=${#fields.hasErrors('customerUpdateDto.*') ? 'true' : 'false'},
                 data-show-edit-admin-modal=${#fields.hasErrors('adminUpdateDto.*') ? 'true' : 'false'}">
		<div
			class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
			<h1 class="mb-3 mb-md-0 section-title">User Management</h1>
			<div class="d-flex gap-2">
				<button class="btn btn-action-add" type="button"
					data-bs-toggle="modal" data-bs-target="#addCustomerModal">
					<i class="fa-solid fa-plus me-1"></i> Add Customer
				</button>
				<button class="btn btn-action-view" type="button"
					data-bs-toggle="modal" data-bs-target="#manageAdminsModal">
					<i class="fa-solid fa-user-shield me-1"></i> Manage Admins
				</button>
			</div>
		</div>

		<div th:replace="~{admin/fragments/common-alerts :: userAlerts}"></div>


		<form th:action="@{/admin/customers}" method="get"
			class="mb-4 p-3 bg-light rounded shadow-sm">
			<div class="row g-3 align-items-end">
				<div class="col-md-10">
					<label for="keyword" class="form-label">Search by Name,
						Username, Phone</label> <input type="text" class="form-control"
						id="keyword" name="keyword" th:value="${keyword}"
						placeholder="Enter search term...">
				</div>
				<div class="col-md-2 d-flex justify-content-end">
					<button type="submit" class="btn btn-action-view me-2">
						<i class="fa-solid fa-search me-1"></i> Search
					</button>
					<a th:href="@{/admin/customers}" class="btn btn-custom-secondary"
						title="Clear Filters"> <i class="fa-solid fa-times"></i>
					</a>
				</div>
			</div>
		</form>

		<div class="row text-center mb-4">
			<div class="col-md-4 mb-3">
				<div class="stats-card card shadow-sm">
					<div class="card-body">
						<h5 class="card-title">Total Customers</h5>
						<p class="display-6 fw-bold" th:text="${#lists.size(customers)}">0</p>
					</div>
				</div>
			</div>
			<div class="col-md-4 mb-3">
				<div class="stats-card card shadow-sm">
					<div class="card-body">
						<h5 class="card-title">Total Admins</h5>
						<p class="display-6 fw-bold" th:text="${#lists.size(admins)}">0</p>
					</div>
				</div>
			</div>
			<div class="col-md-4 mb-3">
				<div class="stats-card card shadow-sm">
					<div class="card-body">
						<h5 class="card-title">Active Customers</h5>
						<p class="display-6 fw-bold text-muted"
							th:text="${customers.?[status != null and status == 'ACTIVE'].size()}">?</p>
					</div>
				</div>
			</div>
		</div>

		<div class="card">
			<div class="card-header">
				<h5 class="mb-0">Customers List</h5>
			</div>
			<div class="card-body">
				<div class="table-responsive">
					<table class="table table-hover align-middle text-center">
						<thead class="table-light">
							<tr>
								<th>ID</th>
								<th>Name</th>
								<th>Username</th>
								<th>Email</th>
								<th>Phone</th>
								<th>Address</th>
								<th>Status</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="customer : ${customers}"
								th:data-name="${customer.firstName + ' ' + customer.lastName}"
								th:data-username="${customer.username}"
								th:data-email="${customer.email != null ? customer.email : 'N/A'}"
								th:data-phone="${customer.phone != null ? customer.phone : 'N/A'}"
								th:data-address-line1="${(customer.houseNo != null ? customer.houseNo : '') + ' ' + (customer.street != null ? customer.street : '')}"
								th:data-address-line2="${(customer.barangay != null ? customer.barangay : '') + ', ' + (customer.municipality != null ? customer.municipality : '') + ', ' + (customer.province != null ? customer.province : '')}"
								th:data-created-at="${customer.createdAt != null ? #temporals.format(customer.createdAt, 'MMM dd, yyyy HH:mm') : 'N/A'}"
								th:data-last-activity="${customer.lastActivity != null ? #temporals.format(customer.lastActivity, 'MMM dd, yyyy HH:mm') : 'N/A'}"
								th:data-status="${customer.status}">

								<td th:text="${customer.id}">001</td>
								<td th:text="${customer.firstName + ' ' + customer.lastName}">Juan
									Dela Cruz</td>
								<td th:text="${customer.username}">Juan_Dela</td>
								<td th:text="${customer.email != null ? customer.email : 'N/A'}">N/A</td>
								<td th:text="${customer.phone != null ? customer.phone : 'N/A'}">N/A</td>
								<td
									th:text="${customer.street != null ? (customer.street + ', ' + customer.barangay) : 'N/A'}">N/A</td>
								<td>
									<span class="status-badge"
									th:text="${customer.status != null ? customer.status : 'N/A'}"
									th:classappend="${customer.status == 'ACTIVE' ? 'status-active' : 'status-cancelled'}">Status</span>
								</td>
								<td class="d-flex justify-content-center gap-2">
									<button class="btn btn-sm btn-action-view"
										data-bs-toggle="modal" data-bs-target="#viewCustomerModal">View</button>

									<button type="button"
										class="btn btn-sm btn-action-edit edit-customer-btn"
										data-bs-toggle="modal" data-bs-target="#editCustomerModal"
										th:data-id="${customer.id}"
										th:data-first-name="${customer.firstName}"
										th:data-last-name="${customer.lastName}"
										th:data-username="${customer.username}"
										th:data-email="${customer.email}"
										th:data-phone="${customer.phone}"
										th:data-house-no="${customer.houseNo}"
										th:data-lot-no="${customer.lotNo}"
										th:data-block-no="${customer.blockNo}"
										th:data-street="${customer.street}"
										th:data-barangay="${customer.barangay}"
										th:data-municipality="${customer.municipality}"
										th:data-province="${customer.province}"
										th:data-status="${customer.status}">Edit</button>

									<form
										th:action="@{/admin/customers/delete/{id}(id=${customer.id})}"
										method="post"
										onsubmit="return confirm('Are you sure you want to delete this customer?');">
										<button type="submit" class="btn btn-sm btn-action-delete">Delete</button>
									</form>
								</td>
							</tr>
							<tr th:if="${#lists.isEmpty(customers)}">
								<td colspan="8" class="text-center text-muted"
									th:text="${keyword != null ? 'No customers found matching your search.' : 'No customers found.'}">
									No customers found.</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="d-flex justify-content-between align-items-center mt-3">
					<button class="btn btn-outline-secondary btn-sm" disabled>Previous</button>
					<span>Page 1 of 1</span>
					<button class="btn btn-outline-secondary btn-sm" disabled>Next</button>
				</div>
			</div>
		</div>

		<div th:replace="~{admin/fragments/user-modals :: all-user-modals}"></div>

	</main>

	<th:block th:fragment="script">
		<script th:src="@{/js/admin-users.js}"></script>
	</th:block>

</body>
</html>