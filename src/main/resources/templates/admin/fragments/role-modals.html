<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

	<div th:fragment="all-role-modals(allAdminRoles)">

		<div class="modal fade" id="manageRolesModal" tabindex="-1"
			aria-labelledby="manageRolesModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="manageRolesModalLabel">Manage
							Admin Roles</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form sec:authorize="hasRole('OWNER')"
							th:action="@{/admin/admins/roles/add}" method="post"
							th:object="${roleDto}" id="addRoleForm" class="mb-4">
							<h6 class="mb-3">Add New Role</h6>
							<div th:if="${#fields.hasErrors('roleDto.*')}"
								class="alert alert-danger small p-2" role="alert">Error
								adding role. Please check below.</div>
							<div class="mb-3">
								<label for="newRoleName" class="form-label">Role Name</label> <input
									type="text" class="form-control"
									placeholder="New role name (e.g., SUPERVISOR)"
									th:field="*{name}" th:errorclass="is-invalid" id="newRoleName">
								<div class_w="invalid-feedback"
									th:if="${#fields.hasErrors('name')}" th:errors="*{name}">...</div>
								<div class="form-text">Role name must be uppercase,
									letters and underscores only.</div>
							</div>

							<h6 class="mb-3 mt-4">Assign Permissions</h6>
							<div class="row">
								<div class="col-md-6">
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageCustomers}" id="addRoleManageCustomers">
										<label class="form-check-label" for="addRoleManageCustomers">Customer
											Management</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageAdmins}" id="addRoleManageAdmins">
										<label class="form-check-label" for="addRoleManageAdmins">Admin
											Management</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageOrders}" id="addRoleManageOrders">
										<label class="form-check-label" for="addRoleManageOrders">Order
											Management</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageProducts}" id="addRoleManageProducts">
										<label class="form-check-label" for="addRoleManageProducts">Product
											Management</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageInventory}" id="addRoleManageInventory">
										<label class="form-check-label" for="addRoleManageInventory">Inventory
											Management</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageTransactions}"
											id="addRoleManageTransactions"> <label
											class="form-check-label" for="addRoleManageTransactions">Transaction
											History</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageSite}" id="addRoleManageSite"> <label
											class="form-check-label" for="addRoleManageSite">Site
											Management</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageActivityLog}" id="addRoleManageActivityLog">
										<label class="form-check-label" for="addRoleManageActivityLog">View
											Activity Log</label>
									</div>
								</div>
							</div>

							<div class="text-end mt-3">
								<button class="btn btn-action-add w-100" type="submit">Add
									This Role</button>
							</div>
						</form>
						<hr sec:authorize="hasRole('OWNER')">

						<h6 class="mb-3">Existing Roles</h6>
						<div th:if="${#lists.isEmpty(allAdminRoles)}" class="text-muted">No
							custom roles found.</div>

						<ul class="list-group list-group-flush"
							th:unless="${#lists.isEmpty(allAdminRoles)}">
							<li th:each="role : ${allAdminRoles}"
								class="list-group-item d-flex justify-content-between align-items-center ps-0">
								<span th:text="${role.name.replace('ROLE_', '')}">ROLE</span>
								<div class="d-flex gap-2" sec:authorize="hasRole('OWNER')">
									<button type="button"
										class="btn btn-sm btn-action-edit edit-role-btn"
										data-bs-toggle="modal" data-bs-target="#editRoleModal"
										th:disabled="${role.name == 'ROLE_OWNER'}"
										th:title="${role.name == 'ROLE_OWNER' ? 'Owner role cannot be edited.' : 'Edit Role'}"
										th:data-id="${role.id}"
										th:data-name="${role.name.replace('ROLE_', '')}"
										th:data-manage-customers="${role.permissions.contains('VIEW_CUSTOMERS')}"
										th:data-manage-admins="${role.permissions.contains('VIEW_ADMINS')}"
										th:data-manage-orders="${role.permissions.contains('VIEW_ORDERS')}"
										th:data-manage-products="${role.permissions.contains('VIEW_PRODUCTS')}"
										th:data-manage-inventory="${role.permissions.contains('VIEW_INVENTORY')}"
										th:data-manage-transactions="${role.permissions.contains('VIEW_TRANSACTIONS')}"
										th:data-manage-site="${role.permissions.contains('EDIT_SITE_SETTINGS')}"
										th:data-manage-activity-log="${role.permissions.contains('VIEW_ACTIVITY_LOG')}">
										Edit</button>
									<form
										th:action="@{/admin/admins/roles/delete/{id}(id=${role.id})}"
										method="post"
										th:data-confirm-message="'Are you sure you want to delete the role \'' + ${role.name.replace('ROLE_', '')} + '\'? This cannot be undone.'">
										<button type="submit" class="btn btn-sm btn-action-delete"
											th:disabled="${role.name == 'ROLE_OWNER'}"
											th:title="${role.name == 'ROLE_OWNER' ? 'Owner role cannot be deleted.' : 'Delete Role'}">
											Delete</button>
									</form>
								</div>
							</li>
						</ul>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-custom-secondary"
							data-bs-dismiss="modal">Cancel</button>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="editRoleModal" tabindex="-1"
			aria-labelledby="editRoleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<form th:action="@{/admin/admins/roles/update}" method="post"
						th:object="${roleUpdateDto}" id="editRoleForm">
						<div class="modal-header">
							<h5 class="modal-title" id="editRoleModalLabel">Edit Role</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div th:if="${#fields.hasErrors('roleUpdateDto.*')}"
								class="alert alert-danger small p-2" role="alert">Please
								correct the errors below.</div>

							<input type="hidden" th:field="*{id}" />

							<div class="mb-3">
								<label for="editRoleName" class="form-label">Role Name</label> <input
									type="text" class="form-control" th:field="*{name}"
									id="editRoleName" th:errorclass="is-invalid">
								<div class="invalid-feedback"
									th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Name
									Error</div>
								<div class="form-text">Role name must be uppercase,
									letters and underscores only.</div>
							</div>

							<h6 class="mb-3 mt-4">Assign Permissions</h6>
							<div class="row">
								<div class="col-md-6">
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageCustomers}" id="editRoleManageCustomers">
										<label class="form-check-label" for="editRoleManageCustomers">Customer
											Management</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageAdmins}" id="editRoleManageAdmins">
										<label class="form-check-label" for="editRoleManageAdmins">Admin
											Management</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageOrders}" id="editRoleManageOrders">
										<label class="form-check-label" for="editRoleManageOrders">Order
											Management</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageProducts}" id="editRoleManageProducts">
										<label class="form-check-label" for="editRoleManageProducts">Product
											Management</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageInventory}" id="editRoleManageInventory">
										<label class="form-check-label" for="editRoleManageInventory">Inventory
											Management</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageTransactions}"
											id="editRoleManageTransactions"> <label
											class="form-check-label" for="editRoleManageTransactions">Transaction
											History</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageSite}" id="editRoleManageSite"> <label
											class="form-check-label" for="editRoleManageSite">Site
											Management</label>
									</div>
									<div class="form-check form-switch mb-2">
										<input class="form-check-input" type="checkbox" role="switch"
											th:field="*{manageActivityLog}"
											id="editRoleManageActivityLog"> <label
											class="form-check-label" for="editRoleManageActivityLog">View
											Activity Log</label>
									</div>
								</div>
							</div>

						</div>
						<div class="modal-footer">
							<button type="submit" class="btn btn-custom">Save
								Changes</button>
							<button type="button" class="btn btn-custom-secondary"
								data-bs-dismiss="modal">Cancel</button>
						</div>
					</form>
				</div>
			</div>
		</div>

	</div>
</body>
</html>