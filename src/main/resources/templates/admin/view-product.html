<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{admin/base :: layout(~{::main})}">
<head>
<title th:text="${product.name + ' - View Product - MK Admin'}">View
	Product - MK Admin</title>
</head>
<body>
	<main class="container mt-4">

		<div class="row justify-content-center">
			<div class="col-lg-9">
				<div class="card shadow-sm">
					<div
						class="card-header d-flex justify-content-between align-items-center">
						<h3 class="mb-0" th:text="${'Details for ' + product.name}">Product
							Details</h3>
						<a th:href="@{/admin/products}" class="btn btn-sm btn-secondary">
							<i class="fa-solid fa-arrow-left me-1"></i> Back to Products
						</a>
					</div>
					<div class="card-body">
						<div class="row mb-4">
							<div class="col-md-4 text-center">
								<img
									th:src="${product.imageUrl != null && !product.imageUrl.isBlank() ? product.imageUrl : '/img/placeholder.jpg'}"
									class="img-fluid rounded mb-2"
									style="max-height: 250px; object-fit: contain;"
									th:alt="${product.name}"
									onerror="this.onerror=null; this.src='/img/placeholder.jpg';">
							</div>
							<div class="col-md-8">
								<h4 th:text="${product.name}">Product Name</h4>
								<p class="text-muted mb-2" th:text="${product.category.name}">Category</p>
								<p class="fs-5 fw-bold mb-2"
									th:text="'â‚±' + ${#numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')}">Price</p>
								<p class="mb-2">
									<strong>Description:</strong>
								</p>
								<p
									th:text="${product.description != null ? product.description : 'No description available.'}">Description...</p>

								<hr>

								<p class="mb-1">
									<strong>Stock Status:</strong> <span class="badge ms-2"
										th:text="${#strings.replace(product.stockStatus, '_', ' ')}"
										th:classappend="${#strings.equals(product.stockStatus, 'NORMAL') ? 'bg-success' :
														   #strings.equals(product.stockStatus, 'LOW') ? 'bg-warning text-dark' :
														   #strings.equals(product.stockStatus, 'CRITICAL') ? 'bg-danger' :
														   #strings.equals(product.stockStatus, 'NO_STOCK') ? 'bg-dark' : 'bg-secondary'}">
										Stock Status </span>
								</p>
								<p class="mb-1">
									<strong>Current Stock:</strong> <span
										th:text="${product.currentStock}">0</span> units
								</p>
								<p class="mb-1">
									<strong>Low Stock Threshold:</strong> <span
										th:text="${product.lowStockThreshold}">0</span> units
								</p>
								<p class="mb-1">
									<strong>Critical Stock Threshold:</strong> <span
										th:text="${product.criticalStockThreshold}">0</span> units
								</p>
								<p class="small text-muted" th:if="${product.stockLastUpdated}"
									th:text="'Stock last updated: ' + ${#temporals.format(product.stockLastUpdated, 'MMM dd, yyyy HH:mm')}">
									Stock last updated: ...</p>
							</div>
						</div>

						<hr>
						<h5 class="mb-3">Recipe Ingredients</h5>
						<div th:if="${#lists.isEmpty(product.ingredients)}"
							class="alert alert-info small">No ingredients have been
							assigned to this product recipe yet.</div>
						<div th:unless="${#lists.isEmpty(product.ingredients)}"
							class="table-responsive">
							<table class="table table-sm table-striped">
								<thead>
									<tr>
										<th>Ingredient Item</th>
										<th>Quantity Needed</th>
										<th>Unit</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="ingredient : ${product.ingredients}">
										<td th:text="${ingredient.inventoryItem.name}">Flour</td>
										<td
											th:text="${#numbers.formatDecimal(ingredient.quantityNeeded, 1, 'COMMA', 2, 'POINT')}">1.00</td>
										<td th:text="${ingredient.inventoryItem.unit.abbreviation}">kg</td>
									</tr>
								</tbody>
							</table>
						</div>

						<div class="d-flex justify-content-end gap-2 mt-4">
							<a th:href="@{/admin/products/edit/{id}(id=${product.id})}"
								class="btn btn-warning"> <i class="fa-solid fa-pencil me-1"></i>
								Edit Product
							</a>
							<form
								th:action="@{/admin/products/delete/{id}(id=${product.id})}"
								method="post" class="d-inline"
								onsubmit="return confirm('Are you sure you want to delete this product?');">
								<button type="submit" class="btn btn-danger">
									<i class="fa-solid fa-trash me-1"></i> Delete Product
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>

	</main>
</body>
</html>