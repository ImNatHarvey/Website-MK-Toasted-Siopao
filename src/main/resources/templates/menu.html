<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{base :: layout(~{::main})}">
<head>
<meta charset="UTF-8">
<title>Menu - MK Toasted Siopao</title>
</head>
<body>
	<main class="container-fluid px-4 py-4">
		<div class="row">
			<div class="col-lg-9">
				<h2 class="mb-4 section-title">Our Menu</h2>

				<form th:action="@{/menu}" method="get"
					class="mb-4 p-3 bg-light rounded shadow-sm">
					<div class="mb-3">
						<label class="form-label">Filter by Category</label>
						<div class="d-flex flex-wrap gap-2">
							<a th:href="@{/menu(keyword=${keyword})}"
								class="btn btn-sm btn-outline-primary"
								th:classappend="${selectedCategoryId == null ? 'active' : ''}">All
								Categories</a> <a th:each="cat : ${categories}"
								th:href="@{/menu(category=${cat.id}, keyword=${keyword})}"
								class="btn btn-sm btn-outline-primary"
								th:classappend="${selectedCategoryId != null && selectedCategoryId == cat.id ? 'active' : ''}"
								th:text="${cat.name}">Category</a>
						</div>
					</div>

					<div class="d-flex flex-column flex-md-row gap-2">
						<div class="flex-grow-1">
							<label for="keyword" class="form-label">Search by Name</label> <input
								type="text" class="form-control" id="keyword" name="keyword"
								th:value="${keyword}" placeholder="Enter product name...">
							<input type="hidden" name="category"
								th:value="${selectedCategoryId}" />
						</div>
						<div class="d-flex gap-2 align-self-md-end"
							style="flex-shrink: 0;">
							<button type="submit" class="btn btn-action-view" title="Search">
								<i class="fa-solid fa-search"></i> <span
									class="d-none d-md-inline ms-1">Search</span>
							</button>
							<a th:href="@{/menu}" class="btn btn-custom-secondary"
								title="Clear All"> <i class="fa-solid fa-times"></i> <span
								class="d-none d-md-inline ms-1">Clear</span>
							</a>
						</div>
					</div>
				</form>
				<div th:if="${productPage.empty}"
					class="alert alert-warning text-center" role="alert">
					<span
						th:text="${(keyword != null or selectedCategoryId != null) ? 'No products found matching your criteria.' : 'No products found.'}">No
						products added yet.</span>
				</div>

				<div th:unless="${productPage.empty}"
					class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4"
					id="product-list-container">
					<div class="col" th:each="product : ${productPage.content}">
						<div class="card h-100 shadow-sm product-card-public"
							th:data-product-id="${product.id}"
							th:data-product-name="${product.name}"
							th:data-product-price="${product.price}"
							th:data-product-image="${product.imageUrl != null && !#strings.isEmpty(product.imageUrl) ? product.imageUrl : '/img/placeholder.jpg'}">
							<img
								th:src="${product.imageUrl != null && !#strings.isEmpty(product.imageUrl) ? product.imageUrl : '/img/placeholder.jpg'}"
								class="card-img-top" th:alt="${product.name}"
								onerror="this.onerror=null; this.src='/img/placeholder.jpg';">
							<div class="card-body d-flex flex-column">
								<h5 class="card-title" th:text="${product.name}">...</h5>
								<p class="mb-1 text-muted small"
									th:text="${product.category.name}">...</p>

								<div
									class="d-flex justify-content-between align-items-center mb-2 price-stepper-row">
									<p class="mb-0">
										<strong class="fs-5">₱<span
											th:text="${#numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')}">...</span></strong>
									</p>
									<div class="quantity-stepper-inline">
										<button class="btn btn-sm btn-action-delete qty-btn minus"
											type="button" disabled>
											<i class="fa-solid fa-minus"></i>
										</button>
										<input type="text"
											class="form-control form-control-sm qty-input" value="0"
											readonly>
										<button class="btn btn-sm btn-action-add qty-btn plus"
											type="button">
											<i class="fa-solid fa-plus"></i>
										</button>
									</div>
								</div>
								<p class="card-text small mb-3 flex-grow-1"
									th:text="${product.description != null ? #strings.abbreviate(product.description, 70) : 'No description.'}">...</p>

								<div class="mt-auto">
									<button class="btn btn-sm btn-warning w-100 btn-add-to-order">
										<i class="fa-solid fa-cart-plus me-1"></i> Add to Order
									</button>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>

			<div class="col-lg-3">
				<div class="order-summary sticky-top p-4 rounded shadow-sm"
					style="top: 80px;">
					<h3 class="order-title mb-4">
						My Order
						<button class="btn btn-sm btn-outline-danger btn-clear-cart"
							style="float: right; font-size: 0.75rem; padding: 0.2rem 0.5rem;">Clear</button>
					</h3>
					<div class="empty-order text-center py-3">
						<p class="text-muted mb-0">Your bag is empty.</p>
					</div>

					<div class="order-items-list d-none"
						style="max-height: 400px; overflow-y: auto;"></div>

					<div class="mt-4 pt-3 border-top">
						<div
							class="d-flex justify-content-between align-items-center mb-3">
							<h5 class="mb-0">Total:</h5>
							<span class="total-price fw-bold fs-5">₱0.00</span>
						</div>
						<div class="d-grid">
							<button type="button" id="go-to-checkout-btn"
								class="btn btn-checkout px-4" disabled>Proceed to
								Checkout</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div th:if="${productPage.totalPages > 0}"
			class="d-flex justify-content-center mt-4">

			<nav aria-label="Product Pagination">
				<ul class="pagination pagination-sm mb-0">

					<li class="page-item"
						th:classappend="${productPage.first} ? 'disabled'"><a
						class="page-link"
						th:href="@{/menu(page=${productPage.number - 1}, size=${size}, keyword=${keyword}, category=${selectedCategoryId})}">Previous</a>
					</li>

					<th:block
						th:each="i : ${#numbers.sequence(0, productPage.totalPages - 1)}"
						th:if="${productPage.totalPages <= 7 || i == 0 || i == productPage.totalPages - 1 || (i >= productPage.number - 2 && i <= productPage.number + 2)}">

						<li class="page-item disabled"
							th:if="${productPage.totalPages > 7 && (i == 0 && productPage.number > 3 || i == productPage.totalPages - 1 && productPage.number < productPage.totalPages - 4)}">
							<span class="page-link">...</span>
						</li>

						<li class="page-item"
							th:classappend="${i == productPage.number} ? 'active'"><a
							class="page-link"
							th:href="@{/menu(page=${i}, size=${size}, keyword=${keyword}, category=${selectedCategoryId})}"
							th:text="${i + 1}"></a></li>
					</th:block>

					<li class="page-item"
						th:classappend="${productPage.last} ? 'disabled'"><a
						class="page-link"
						th:href="@{/menu(page=${productPage.number + 1}, size=${size}, keyword=${keyword}, category=${selectedCategoryId})}">Next</a>
					</li>
				</ul>
			</nav>
		</div>
	</main>
</body>
</html>